<include file="public@header" />
<style type="text/css">
    .table th, .table td {
        text-align: center;
        vertical-align: middle!important;
    }
</style>
</head>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="{:url('ticket/serviceList')}">服务券列表</a>
        </li>
        <li>
            <a href="javascript:parent.openIframeLayer('{:url('Ticket/ticketAddOrUpdate',['type'=>2])}','添加服务券',{});">新增服务券</a>
        </li>
    </ul>
    <!--<form class="well form-inline margin-top-0" method="get" action="{:url('Order/orderList',['order_status' => isset($order_status) ? $order_status : ""])}">-->
    <!--订单号:-->
    <!--<input type="text" class="form-control" name="sn" style="width: 120px;" value="{:input('request.sn/s','')}" placeholder="请输入订单号">-->
    <!--商品名称:-->
    <!--<input type="text" class="form-control" name="subtitle" style="width: 120px;" value="{:input('request.subtitle/s','')}" placeholder="请输入商品名">-->
    <!--购买人:-->
    <!--<input type="text" class="form-control" name="nickname" style="width: 120px;" value="{:input('request.nickname/s','')}" placeholder="请输入购买人">-->
    <!--<input type="submit" class="btn btn-primary" value="搜索" />-->
    <!--<a class="btn btn-danger" href="{:url('Order/orderList',['order_status' => isset($order_status) ? $order_status : ""])}">清空</a>-->
    <!--</form>-->
    <table class="table table-hover table-bordered">
        <thead>
        <tr>
            <th width="50">ID</th>
            <th >标题</th>
            <th >封面</th>
            <th >服务项目</th>
            <th >限购数量</th>
            <th >发行量</th>
            <th >有效天数</th>
            <th >所需</th>
            <th >包含门店</th>
            <th >获取方式</th>
            <th >券类型</th>
            <th >状态</th>
            <th >添加时间</th>
            <th >操作</th>
        </tr>
        </thead>
        <tbody>
        <foreach name="list" item="v">
            <tr style="height: 55px;">
                <td>{$v.id|default=0}</td>
                <td>{$v.name|default=''}</td>
                <td><img src="{$v.cover?$file_host:''}{$v.cover|default=''}" height="80"/></td>
                <td>{$v.service_id.sname|default=''}</td>
                <td>{$v.restrict_num|default=''}</td>
                <td>{$v.circulation|default=''}</td>
                <td>{$v.expire_date|default=''}</td>
                <td>{$v.integral_price|default=''} {$v.get_way.status==1?'元':'积分'}</td>
                <td data-ticketid="{$v.id}" class="view-openId">{$v.shop_id?'<button type="button" class="btn btn-default btn-sm view-btn">
                    <span  class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span> 查看
                </button>':'暂未添加门店'}
                </td>
                <td>{$v.get_way.name|default=''}</td>
                <td>{$v.type == 1?'代金券':'服务券'}</td>
                <td>{:isset($v['status'])&&$v.status == 1?'上架':'下架'}</td>
                <td>{$v.addtime|default=''}</td>
                <td>
                    <a href="javascript:parent.openIframeLayer('{:url('Ticket/ticketAddOrUpdate', ['id'=>$v.id])}','详情',{});">编辑</a>|
                    <a href="javascript:void (0);" onclick="deletes('{:url('ticket/delTicket')}',{$v.id})">删除</a>
                </td>
            </tr>
        </foreach>
        </tbody>
    </table>
    <div class="pagination" style="float: left">
        {$page}
    </div>
</div>
<script src="__STATIC__/js/admin.js"></script>
<script type="text/javascript">
    //显示门店
    $(function () {
        $('.view-btn').click(function(){
            var id = $(this).parent().attr('data-ticketid')
            $.post("{:url('Ticket/getBindShopList')}",{'id':id},function(res){
                if (res.code === 200){
                    var html = '<div style="margin-top: 5px;">';
                    $.each(res.data,function(i,val){  //遍历二维数组
                        html += '<button class="btn btn-primary" style="float:left;margin-left: 2px;">'+ val.name+'</button>';
                    })
                    html += '</div>';
                    layer.open({
                        title: '门店信息',
                        type: 1,
                        area: ['300px', '300px'],
                        skin: 'layui-layer-demo', //样式类名
                        closeBtn: 1, //不显示关闭按钮
                        anim: 0,
                        shadeClose: true, //开启遮罩关闭
                        content: html
                    });
                } else{
                    layer.msg(res.msg,{icon:0});
                }
            })
        });
    });
    function deletes(url,id){
        layer.confirm('确认要删除？', {
            btn: ['确定','取消'] //按钮
        }, function(){
            $.post(url, { ticket_id: id }, function(data){
                if (data.code == 200) {
                    layer.msg(data.msg, {icon: 1,time:1000},function f() {
                        reloads();
                    });
                }else {
                    layer.msg(data.msg, {icon: 0,time:1000});
                }
            });
        });
    };
    //------------------------------------------------

    //刷新页面
    function reloads(){
        window.location.reload();
    }
</script>
</body>
</html>
